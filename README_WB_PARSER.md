# Python парсер для Wildberries

## Обзор

Этот проект включает в себя Python парсер специально для Wildberries, который позволяет обходить антибот-защиту маркетплейса и собирать данные о товарах напрямую с веб-страниц.

## Структура

```
market_parser.py/
└── wb_full_parser.py.txt  # Основной Python скрипт парсера Wildberries
src/lib/
├── wildberries-parser.ts   # TypeScript сервис для работы с парсером
└── marketplace-sync.ts     # Сервис синхронизации (использует парсер для Wildberries)
src/app/api/marketplace-accounts/parse/
└── route.ts                # API endpoint для запуска парсинга Wildberries
src/app/wb-test/
└── page.tsx                # Страница тестирования парсинга
src/components/wildberries/
└── WBTestParser.tsx        # Компонент для тестирования парсинга
src/api/
├── ozon.ts                 # Клиент API для Ozon
├── wildberries.ts          # Клиент API для Wildberries (с поддержкой парсера)
└── yandex-market.ts        # Клиент API для Яндекс.Маркет
```

## Функциональность

### Python парсер (wb_full_parser.py.txt)
- Парсит категории товаров Wildberries
- Собирает информацию: Название, Цена, Скидка, Рейтинг, Отзывы, Наличие, Продавец, Категория, Бренд, Артикул, Ссылка, Изображение
- Обходит антибот-защиту с помощью:
  - Реальных User-Agent заголовков
  - Случайных задержек между запросами
  - Обработки robots.txt
  - Экспоненциальной задержки при блокировке

### TypeScript сервис (wildberries-parser.ts)
- Проверяет доступность Python парсера
- Запускает парсинг через child_process
- Обрабатывает результаты парсинга
- Сохраняет данные в БД (в разработке)

### Страница тестирования
- Доступна по адресу `/wb-test`
- Позволяет вручную запускать парсинг с настройкой параметров
- Отображает результаты парсинга в таблице

### API endpoint (route.ts)
- `POST /api/marketplace-accounts/parse` - запуск парсинга Wildberries
- Параметры:
  - `account_id` - ID аккаунта Wildberries
  - `url` - URL категории для парсинга (опционально)
  - `category` - Метка категории (опционально)
  - `limit` - Лимит товаров (опционально)

## Использование

### Через веб-интерфейс

1. Перейдите на страницу `/wb-test`
2. Введите ID аккаунта Wildberries
3. Укажите URL категории, название категории и лимит товаров
4. Нажмите "Запустить парсинг"
5. Результаты отобразятся в таблице

### Через API

```bash
curl -X POST http://localhost:3000/api/marketplace-accounts/parse \
  -H "Content-Type: application/json" \
  -d '{
    "account_id": "your-account-id",
    "url": "https://www.wildberries.ru/catalog/elektronika/telefony",
    "category": "Электроника/Телефоны",
    "limit": 100
  }'
```

### Прямой запуск Python скрипта

```bash
python market_parser.py/wb_full_parser.py.txt \
  --url "https://www.wildberries.ru/catalog/elektronika/telefony" \
  --category "Электроника/Телефоны" \
  --limit 100
```

## Настройки

### Конфигурация парсера

В файле `wb_full_parser.py.txt` можно настроить:

```python
USER_AGENTS = [
    # Список User-Agent заголовков
]

SLEEP_MIN = 0.8  # Минимальная задержка между запросами
SLEEP_MAX = 2.4  # Максимальная задержка между запросами
MAX_RETRIES = 4  # Максимальное количество повторов
```

## Интеграция с основной системой

Сервис синхронизации (`marketplace-sync.ts`) автоматически использует Python парсер для Wildberries:

1. При синхронизации Wildberries аккаунта система автоматически вызывает Python парсер
2. Если парсер недоступен, используется fallback на официальный API (менее надежно)
3. Результаты парсинга сохраняются в единую базу данных вместе с данными других маркетплейсов

## Разработка

### Добавление обработки результатов парсинга

Функция `saveParsedData` в `wildberries-parser.ts` пока не реализована полностью. Для завершения интеграции необходимо:
1. Установить библиотеку для работы с Excel (например, `xlsx`)
2. Реализовать чтение файла `result.xlsx`
3. Преобразовать данные в формат БД
4. Сохранить данные в таблицу `products`

### Тестирование

Запустите тестовый скрипт:

```bash
npx ts-node test_wb_parser.ts
```

## Безопасность

⚠️ **Важно**: Использование парсера может нарушать условия использования Wildberries. Используйте его ответственно и в соответствии с robots.txt и ToS маркетплейса.

## Лицензия

Код предоставляется как есть, без гарантий. Используйте на свой страх и риск.