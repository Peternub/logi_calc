# Работа с парсингом Wildberries

## Общая информация

Wildberries активно защищается от автоматизированного парсинга и использует различные методы для блокировки ботов:
- HTTP 498 ошибки для подозрительных запросов
- CAPTCHA проверки
- Rate limiting (ограничение количества запросов)
- Поведенческий анализ

## Почему парсинг может не работать

1. **Блокировка по HTTP 498** - Wildberries определяет автоматизированные запросы и блокирует их
2. **CAPTCHA** - Маркетплейс может требовать подтверждение, что запрос отправлен человеком
3. **Rate limiting** - Слишком частые запросы приводят к временной блокировке
4. **IP блокировка** - Повторные попытки парсинга могут привести к блокировке IP адреса

## Рекомендации по работе с парсером

### 1. Использование прокси
Для обхода IP блокировок рекомендуется использовать прокси сервера:
```bash
# Пример использования прокси в Python скрипте
export HTTP_PROXY=http://proxy-server:port
export HTTPS_PROXY=https://proxy-server:port
```

### 2. Увеличение задержек между запросами
В скрипте можно увеличить параметры задержек:
```python
SLEEP_MIN = 2.0  # Минимальная задержка между запросами
SLEEP_MAX = 5.0  # Максимальная задержка между запросами
```

### 3. Ротация User-Agent заголовков
Использование разных User-Agent для каждого запроса:
```python
USER_AGENTS = [
    "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/117.0.0.0 Safari/537.36",
    "Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.1 Safari/605.1.15",
    "Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/118.0.0.0 Safari/537.36",
]
```

### 4. Обработка ошибок
Скрипт должен корректно обрабатывать ошибки блокировки:
```python
try:
    response = session.get(url, timeout=timeout, proxies=PROXIES)
    if response.status_code == 498:
        # Обработка блокировки
        wait = (2 ** attempt) + random.random()
        time.sleep(wait)
except requests.RequestException as e:
    # Обработка сетевых ошибок
    pass
```

## Использование через веб-интерфейс

1. Перейдите на страницу `/wb-test`
2. Введите ID аккаунта Wildberries
3. Укажите URL категории для парсинга
4. Введите название категории
5. Установите лимит товаров (рекомендуется не более 10 для тестирования)
6. Нажмите кнопку "Запустить парсинг"

## Возможные ошибки и их решения

### Ошибка: "Wildberries заблокировал запрос как подозрительный"
**Решение:** 
- Используйте прокси сервера
- Увеличьте задержки между запросами
- Попробуйте позже

### Ошибка: "Файл с результатами парсинга не найден"
**Решение:**
- Проверьте, что Python скрипт завершился успешно
- Убедитесь, что у скрипта есть права на запись в директорию

### Ошибка: "ModuleNotFoundError"
**Решение:**
- Установите необходимые Python библиотеки:
```bash
pip install requests beautifulsoup4 lxml pandas openpyxl
```

## Альтернативные решения

Если парсинг не работает, рассмотрите следующие альтернативы:

1. **Официальное API Wildberries** - если доступно для вашего аккаунта
2. **Партнерские программы** - которые предоставляют доступ к данным
3. **Сторонние сервисы** - которые специализируются на сборе данных с маркетплейсов

## Безопасность

⚠️ **Важно**: Использование парсера может нарушать условия использования Wildberries. Используйте его ответственно и в соответствии с robots.txt и ToS маркетплейса.

## Лицензия

Код предоставляется как есть, без гарантий. Используйте на свой страх и риск.